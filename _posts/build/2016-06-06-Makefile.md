---
layout: post
title: "Makefile 语法详解"
categories: Linux
tags: Makefile
---

* content
{:toc}

本文介绍 GNU make 的 Makefile 语法。




## 写 Makefile

Makefile 告诉 make 程序，如何编译，链接，以及处理程序。

### Makefile 的组成

Makefile 中包含 5 类语句：显式规则，隐式规则，变量定义，指令和注释。下面主要从这五个
方面描述 Makefile 的语法。

### Makefile 文件名

默认情况下，make 程序按照以下文件名查找顺序，查找 Makefile：
`GUNmakefile，makefile 和 Makefile`
你的 makefile 通常应该叫做 `makefile` 或者 `Makefile`。推荐叫做 `Makefile` 因为它
出现在文件夹列表的前面，并且靠近 README 文件。

如果指定的文件名不是以一个斜线开始，并且文件没有在当前文件夹中找到，会搜索其他几个文件
夹：首先会搜索通过选项 -I 或者 --include-dir 包含的文件夹。然后搜索以下文件夹：
`/usr/local/include /usr/gnu/include /usr/local/include /usr/include` 当仍然找不
到时，make 会继续处理其他的内容，当所有的内容都读入之后，会尝试构建没有找到的 
Makefile，如果无法构建出该 makefile , make 会报错并退出。

### 包含其它 Makefile

Makefile 可以使用 include 指令包含其它的 Makefile。当 make 程序遇到 include 指令的
时候，它会暂停读取当前 Makefile，而去读取出现在 include 指令中的所有的 Makefile。在
处理 include 指令的时候会进行通配符以及变量的扩展。例如：如果存在三个 Makefile，a.mk，
b.mk，c.mk，并且 $(bar) 扩展为 bish 和 bash，那么以下表达式：

    include *.mk $(bar)

等同于：

    include a.mk b.mk c.mk bish bash

include 指令中可以包含多个 Makefile，多个 Makefile 之间以空格分隔。include 指令前面
可以存在空白，空白将会被 make 忽略。但是第一个字符一定不能是 TAB 键。

可以使用 `-include` 来代替 `include` 忽略包含文件未找到的错误。`-` 意思是告诉 make，
忽略操作错误，make 继续执行。

    -include FILENAMES...
    
### 变量 MAKEFILES


Makefile 如何被重构
----

Make如何读取 Makefile
----

## 写规则（rule）

Makefile 的规则决定了什么时候以及如何更新规则的目标(target)。大多数情况下，每条规则
只有一个目标。规则还列出了目标所依赖的前提条件，以及用于更新或者创建目标的命令。

除了用于决定默认目标外，规则的顺序无关紧要。如果你没有显式地指定一个默认目标，那么
Makefile 中的第一个目标就是默认目标。但是存在两种特殊情况：如果第一个目标以一个点(.)
开始，那么它不能被当做默认目标，除非它同时包含了一个或者多个斜线(/)；模式规则的目标也
不能作为默认目标。因此，基于这些理由，我们在写 Makefile 的时候，通常将第一个规则的目标
指定为我们要构建的整个程序的名字。

### Rules 语法


在文件名中使用通配符
----

前提条件的搜索目录
----

### 伪(Phony)目标

伪目标并不是一个真正的文件名。它仅仅是你想要执行某一系列动作名字。使用伪目标有两个原因：
避免有一个文件和你要执行的动作同名；提升性能。

如果你写了一个不会创建目标文件的规则，那么该规则的命令每一次都会被执行，例如：

```makefile
clean:
        rm *.o temp
```

因为 rm 命令并不会创建一个叫做 clean 的文件，因此 make 认为 clean 目标始终需要生成，
当你每次执行 `make clean` 的时候，rm 命令都会被执行。

没有 Recipe 或 Prerequisites 的 Rule
----

使用空的 Target 文件记录事件
----

内建的特殊 Target 名
----

静态模式规则
----

双冒号规则
----

自动生成前提条件
----

写 Recipe
====

Recipe 语法
----

Recipe 回显
----

Recipe 执行
----

并行执行
----

错误
----

中断或者杀死 make
----

make 的递归使用
----

使用空的 Recipe
----

变量
====

基本变量引用
----

两种不同行为的变量
----

引用变量的高级特性
----

变量如何得到值
----

设置变量
----

往变量追加文本
----

override 指令
----

定义跨多行的多行变量
----

环境变量
----

Target 特定变量
----

Pattern 特定变量
----

其他特殊变量
----

Makefile 中的条件部分
====

使用函数处理文本
====

函数调用语法
----

使用函数处理字符串
----

文件名操作函数
----

条件操作函数
----

make 选项
====

使用参数执行 Makefile
----

使用参数指定 目标
----

不执行
----

使用 隐式规则
====

